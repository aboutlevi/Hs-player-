<!DOCTYPE html>
<html lang="fr" data-bs-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>⚡ SportStream Pro - Lecteur Premium</title>

<!-- Bootstrap 5 Dark Theme -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

<!-- Video.js avec skin -->
<link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
<link href="https://unpkg.com/@videojs/themes@1.0.0/dist/forest/index.css" rel="stylesheet">

<style>
body { background:#0f172a; color:#e2e8f0; font-family:'Segoe UI',sans-serif; }
.navbar-glass { background: rgba(15,23,42,0.8); backdrop-filter: blur(10px); border-bottom:1px solid rgba(255,255,255,0.1);}
.player-container { max-width:900px; margin:0 auto; border-radius:15px; overflow:hidden; }
.channel-card { cursor:pointer; padding:10px; border-radius:10px; background:rgba(30,41,59,0.6); margin-bottom:10px; transition:0.3s;}
.channel-card.active { border:2px solid #10b981; background:rgba(16,185,129,0.2);}
.badge-4k {background:#ff6b6b;} .badge-fhd {background:#48dbfb;} .badge-hd {background:#1dd1a1;} .badge-sd {background:#8395a7;} .badge-live {background:#ff9f43;}
</style>
</head>
<body>

<nav class="navbar navbar-glass fixed-top p-3">
  <span class="fs-4 fw-bold">SportStream Pro</span>
</nav>

<div class="container" style="padding-top:100px;">
  <div class="player-container mb-4">
    <video id="video-player" class="video-js vjs-theme-forest vjs-fluid" controls preload="auto">
      <p class="vjs-no-js">JavaScript est requis pour ce lecteur.</p>
    </video>
  </div>

  <h5>Chaînes Disponibles</h5>
  <div id="channelsContainer" class="row"></div>
</div>

<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
class HlsPlayer {
    constructor() {
        this.player = videojs('video-player', {fluid:true, autoplay:true});
        this.hls = null;
        this.channels = [];
        this.currentChannel = null;
        this.loadChannelsFromURL();
    }

    loadChannelsFromURL() {
        try {
            const params = new URLSearchParams(window.location.search);
            const channelsParam = params.get('channels');
            if(channelsParam){
                this.channels = JSON.parse(decodeURIComponent(channelsParam));
                this.displayChannels();
                if(this.channels.length>0){
                    this.loadChannel(this.channels[0]);
                }
            } else {
                alert('Aucune chaîne détectée dans l\'URL');
            }
        } catch(e) {
            console.error('Erreur parsing channels:', e);
        }
    }

    displayChannels(){
        const container = document.getElementById('channelsContainer');
        container.innerHTML = '';
        this.channels.forEach((c,i)=>{
            const div = document.createElement('div');
            div.className='col-12 col-md-6 col-lg-4';
            div.innerHTML = `<div class="channel-card" onclick="player.loadChannel(player.channels[${i}])">
                <strong>${c.name}</strong> <span class="badge ${this.getBadge(c.quality)}">${c.quality}</span><br>
                <small>${c.group||'Autre'}</small>
            </div>`;
            container.appendChild(div);
        });
    }

    getBadge(quality){
        quality = quality.toLowerCase();
        if(quality.includes('4k')) return 'badge-4k';
        if(quality.includes('fhd')) return 'badge-fhd';
        if(quality.includes('hd')) return 'badge-hd';
        if(quality.includes('sd')) return 'badge-sd';
        if(quality.includes('live')) return 'badge-live';
        return 'badge-secondary';
    }

    loadChannel(channel){
        this.currentChannel = channel;
        document.querySelectorAll('.channel-card').forEach(c=>c.classList.remove('active'));
        // marque active
        Array.from(document.querySelectorAll('.channel-card')).forEach((c,i)=>{
            if(this.channels[i]===channel) c.classList.add('active');
        });
        // HLS
        if(this.hls){ this.hls.destroy(); }
        if(Hls.isSupported()){
            this.hls = new Hls();
            this.hls.loadSource(channel.url);
            this.hls.attachMedia(this.player.tech().el());
            this.hls.on(Hls.Events.MANIFEST_PARSED, ()=>{ this.player.play(); });
            this.hls.on(Hls.Events.ERROR,(e,d)=>{ console.error('HLS error:',d); });
        } else if(this.player.canPlayType('application/vnd.apple.mpegurl')){
            this.player.src({src:channel.url,type:'application/x-mpegURL'});
        }
    }
}

let player = new HlsPlayer();
</script>

</body>
</html>
